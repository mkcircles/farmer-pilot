import{a as U,u as A,r as h,A as D,j as e,s as M,B as p,R as ae,b as oe,c as he,v as ue,l as te,d as se}from"./app-33482b9b.js";import{b as k,d as T,e as q,m as G,h as X,i as b,n as H,j as P,k as I,P as E,l as L,o as S,p as le,q as xe,r as fe,t as ge,v as je,w as ne,x as C,y as ve,z,A as w,s as pe,E as ye}from"./Tracker-0f9363de.js";import{F as V}from"./index-2db325be.js";import{B as Ne}from"./index-493f91ff.js";import{L as _e,F as Fe,H as ie,U as we,a as Ae,D as ce,T as be,b as Pe,c as $e,A as Se}from"./index-d18233b6.js";import{F as N}from"./index-6ee6188f.js";import{U as Re}from"./UserGroupIcon-f1371461.js";import{P as Ce}from"./index-44aad086.js";import{W as ze}from"./WithConfirmAlert-ffe2674f.js";import{n as re}from"./numberFormatter-373bc269.js";import"./Transition-160ed615.js";import"./default-config-939e3be8.js";import"./tw-merge-fbb83fc6.js";import"./createLucideIcon-208ae5db.js";import"./square-stack-3be40487.js";import"./copy-ea6268bb.js";import"./x-circle-aa6df87b.js";const De=n=>`${Intl.NumberFormat("us").format(n).toString()}%`,ke=n=>Intl.NumberFormat("us").format(n).toString();function Be(){const n=U(),m=A(i=>i.auth.token),d=A(i=>i.reports.agentsPerformance),r=A(i=>i.reports.stats),{updateAppContextState:c}=h.useContext(D),s={relative:d==null?void 0:d.map(i=>{var l;return{agent_name:i.name,"Farmers Profiled":(i.farmers_count/((l=r==null?void 0:r.system_stats)==null?void 0:l.total_farmers)*100).toFixed(2)}}),absolute:d==null?void 0:d.map(i=>({agent_name:i.name,"Farmers Profiled":i.farmers_count}))},u=(i=`${p}/summary`)=>{c("loading",!0),axios.get(i,{headers:{Authorization:`Bearer ${m}`}}).then(l=>{console.log("Stats Data",l==null?void 0:l.data);let x=l==null?void 0:l.data;l!=null&&l.data&&n(M({reportType:"stats",reportData:x}))}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})},_=(i=`${p}/agents/graph`)=>{c("loading",!0),axios.get(i,{headers:{Authorization:`Bearer ${m}`}}).then(l=>{var o,v;console.log("Agent Graph Data",(o=l==null?void 0:l.data)==null?void 0:o.data);let x=(v=l==null?void 0:l.data)==null?void 0:v.data;l!=null&&l.data&&n(M({reportType:"agentsPerformance",reportData:x}))}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})};return h.useEffect(()=>{_(),u()},[]),e.jsx(k,{className:"my-4",children:e.jsxs(T,{children:[e.jsxs("div",{className:"block sm:flex sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Agent Performance"}),e.jsx(G,{children:"Farmers Profiled"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(X,{variant:"solid",children:[e.jsx(b,{children:"relative"}),e.jsx(b,{children:"absolute"})]})})]}),e.jsxs(H,{children:[e.jsx(P,{children:e.jsx(I,{className:"mt-8 h-80",data:s.relative,index:"agent_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:De,yAxisWidth:40})}),e.jsx(P,{children:e.jsx(I,{className:"mt-8 h-80",data:s.absolute,index:"agent_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:ke,yAxisWidth:40,showXAxis:!0})})]})]})})}function W(){return W=Object.assign||function(n){for(var m=1;m<arguments.length;m++){var d=arguments[m];for(var r in d)Object.prototype.hasOwnProperty.call(d,r)&&(n[r]=d[r])}return n},W.apply(this,arguments)}function Oe(n,m){if(n==null)return{};var d=Ee(n,m),r,c;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(c=0;c<s.length;c++)r=s[c],!(m.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(d[r]=n[r])}return d}function Ee(n,m){if(n==null)return{};var d={},r=Object.keys(n),c,s;for(s=0;s<r.length;s++)c=r[s],!(m.indexOf(c)>=0)&&(d[c]=n[c]);return d}var Y=h.forwardRef(function(n,m){var d=n.color,r=d===void 0?"currentColor":d,c=n.size,s=c===void 0?24:c,u=Oe(n,["color","size"]);return ae.createElement("svg",W({ref:m,xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},u),ae.createElement("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"}))});Y.propTypes={color:E.string,size:E.oneOfType([E.string,E.number])};Y.displayName="Activity";const Le=Y,Ve=({showModal:n,setShowModal:m})=>{const d=U();oe();const{updateAppContextState:r}=h.useContext(D),c=A(a=>{var f;return(f=a.auth)==null?void 0:f.token}),[s,u]=h.useState({name:"",report_type:"farmer-report",from_date:"2023-07-01",to_date:"2023-07-01",district:"",agent_id:"",crops_grown:"",farm_size:"",gender:"",fpo_id:""}),[_,i]=h.useState([]),[l,x]=h.useState([]),o=[{name:"Farmers Report",value:"farmer-report"},{name:"Crops Report",value:"crop-report"},{name:"Agent Summary Report",value:"agent-summary-report"},{name:"Custom Report",value:"custom-report"}],v=()=>{r("loading",!0),axios.post(`${p}/report/register`,{...s},{headers:{Authorization:`Bearer ${c}`}}).then(a=>{m(!1),d(he({id:ue(),message:"Report has been created successfully and queued for processing!"}))}).catch(a=>{}).finally(()=>{r("loading",!1)})},F=()=>{r("loading",!0),axios.get(`${p}/agents/all`,{headers:{Authorization:`Bearer ${c}`}}).then(a=>{var $,y;console.log("Agent Data",($=a==null?void 0:a.data)==null?void 0:$.data);let f=(y=a==null?void 0:a.data)==null?void 0:y.data;a!=null&&a.data&&i(f)}).catch(a=>{console.log(a)}).finally(()=>{r("loading",!1)})},R=()=>{r("loading",!0),axios.get(`${p}/fpos/summary`,{headers:{Authorization:`Bearer ${c}`}}).then(a=>{var $,y;console.log("FPO Data",($=a==null?void 0:a.data)==null?void 0:$.data);let f=(y=a==null?void 0:a.data)==null?void 0:y.data;a!=null&&a.data&&x(f)}).catch(a=>{console.log(a)}).finally(()=>{r("loading",!1)})},B=a=>`${a==null?void 0:a.getFullYear()}-${(a==null?void 0:a.getMonth())+1<10?`0${(a==null?void 0:a.getMonth())+1}`:(a==null?void 0:a.getMonth())+1}-${(a==null?void 0:a.getDate())<10?`0${a==null?void 0:a.getDate()}`:a==null?void 0:a.getDate()}`;return h.useEffect(()=>{F(),R()},[]),e.jsxs("div",{className:`z-[1000] my-3 fixed bg-primary rounded-md shadow-md transition-all h-full top-20 bottom-0 right-0 w-full lg:w-1/2 duration-700  ${n?"translate-x-0  ":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex w-full space-x-8 p-4 ",children:[e.jsx("span",{className:"text-white",onClick:()=>m(!1),children:e.jsx(_e,{icon:"XSquare"})}),e.jsx(q,{className:"text-white",children:"Create New Report"})]}),e.jsx("div",{className:"h-full flex flex-col flex-grow bg-slate-50",children:e.jsxs("form",{className:"py-4 px-8 bg-slate-50",onSubmit:a=>{a.preventDefault(),v()},children:[e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"name",children:"Report Name"}),e.jsx(V,{id:"name",required:!0,type:"text",placeholder:"",value:s==null?void 0:s.name,onChange:a=>u({...s,name:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"report_type",children:"Report Type"}),e.jsx(L,{defaultValue:"farmer-report",value:s==null?void 0:s.report_type,onValueChange:a=>u({...s,report_type:a}),children:o==null?void 0:o.map((a,f)=>e.jsx(S,{value:a==null?void 0:a.value,icon:Fe,children:a==null?void 0:a.name},f))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4 w-full",children:[e.jsx(N,{htmlFor:"from_date",children:"From"}),e.jsx(le,{defaultValue:new Date(s==null?void 0:s.from_date),onValueChange:a=>{u({...s,from_date:B(a)})},className:""})]}),e.jsxs("div",{className:"py-4 w-full",children:[e.jsx(N,{htmlFor:"to_date",children:"To"}),e.jsx(le,{defaultValue:new Date(s==null?void 0:s.to_date),onValueChange:a=>{u({...s,to_date:B(a)})},className:""})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"fpo_id",children:"FPO"}),e.jsx(L,{defaultValue:"",value:s==null?void 0:s.fpo_id,onValueChange:a=>u({...s,fpo_id:a}),children:["All",...l].map((a,f)=>a==="All"?e.jsx(S,{value:"",icon:ie,children:"All FPOs"},f):e.jsx(S,{value:a==null?void 0:a.id,icon:ie,children:a==null?void 0:a.fpo_name},f))})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"agent_id",children:"Agent"}),e.jsx(L,{defaultValue:"",value:s==null?void 0:s.agent_id,onValueChange:a=>u({...s,agent_id:a}),children:["All",..._].map((a,f)=>a==="All"?e.jsx(S,{value:"",icon:Re,children:"All agents"},f):e.jsx(S,{value:a==null?void 0:a.id,icon:we,children:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)},f))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"district",children:"District"}),e.jsx(V,{id:"district",type:"text",placeholder:"District",value:s==null?void 0:s.district,onChange:a=>u({...s,district:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"gender",children:"Gender"}),e.jsx(L,{value:s==null?void 0:s.gender,onValueChange:a=>u({...s,gender:a}),children:["All","Male","Female"].map((a,f)=>a==="All"?e.jsx(S,{value:"",children:a},f):e.jsx(S,{value:a,children:a},f))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"product",children:"Product"}),e.jsx(V,{id:"product",type:"text",placeholder:"E.g Maize",value:s==null?void 0:s.product,onChange:a=>u({...s,product:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"farm_size",children:"Farm Size (Acres)"}),e.jsx(V,{id:"farm_size",type:"number",placeholder:"",value:s==null?void 0:s.farm_size,onChange:a=>u({...s,farm_size:a.target.value})})]})]}),e.jsx("div",{className:"flex py-4",children:e.jsx(Ne,{variant:"primary",className:"w-full",onClick:()=>{},children:"Save"})})]})})]})};function Me(){var K,Q;U(),oe();const n=A(t=>t.auth.token),{updateAppContextState:m}=h.useContext(D),[d,r]=h.useState(!1),[c,s]=h.useState([]),[u,_]=h.useState(1),[i,l]=h.useState(1),[x,o]=h.useState(1),[v,F]=h.useState(""),[R,B]=h.useState(""),[a,f]=h.useState([]),$=t=>{if(a.length===0||(a==null?void 0:a.find(g=>te.isEqual(g,t==null?void 0:t.name))))return!0},y=({showLoading:t}={showLoading:!0})=>{let O=`${p}/reports`;m("loading",t),se.get(O,{headers:{Authorization:`Bearer ${n}`}}).then(g=>{var Z,ee;console.log("Reports Data",(Z=g==null?void 0:g.data)==null?void 0:Z.data);let j=(ee=g==null?void 0:g.data)==null?void 0:ee.data;g!=null&&g.data&&(_(j==null?void 0:j.current_page),F(j==null?void 0:j.prev_page_url),B(j==null?void 0:j.next_page_url),o(j==null?void 0:j.last_page),s(j))}).catch(g=>{console.log(g)}).finally(()=>{m("loading",!1)})};h.useEffect(()=>{y()},[n]),h.useEffect(()=>{i!=u&&l(u)},[u]),h.useEffect(()=>{i!=u&&te.debounce(y,1e3)(`${p}/reports?page=${i||1}`)},[i]),h.useEffect(()=>{d||y({showLoading:!1})},[d]);const J=t=>new Date(t).toLocaleDateString("en-us",{day:"numeric",year:"numeric",month:"short"}),de=t=>(m("loading",!0),new Promise((O,g)=>{se.delete(`${p}/report/${t}`,{headers:{Authorization:`Bearer ${n}`}}).then(()=>{y(),O({title:"success",message:"Report deleted successfully"})}).catch(j=>{console.log(j),g({message:"Something went wrong. Report could not be deleted",title:"error"})}).finally(()=>{m("loading",!1)})})),me=t=>{switch(t){case"crop-report":return"Crops Report";case"farmer-report":return"Farmers Report";case"custom-report":return"Custom Report";default:return t}};return e.jsx("div",{className:"w-full h-full",children:e.jsxs(k,{className:" px-0",children:[e.jsxs("div",{className:"flex border-b space-x-4 items-center w-full lg:justify-between justify-start pb-4",children:[e.jsx("div",{className:"flex items-center w-52 lg:w-80",children:e.jsx(xe,{onValueChange:f,placeholder:"Search Reports...",className:"max-w-md",children:(K=c==null?void 0:c.data)==null?void 0:K.map(t=>e.jsx(fe,{value:t==null?void 0:t.name,children:t==null?void 0:t.name},t==null?void 0:t.id))})}),e.jsx("div",{className:"flex",children:e.jsxs("button",{onClick:()=>r(!0),className:"group flex space-x-2 px-4 py-3 border border-secondary rounded text-secondary",children:[e.jsx(Ae,{className:"w-5 h-5 group-hover:scale-125 "}),e.jsx("span",{className:"group-hover:scale-95",children:"New Report"})]})})]}),e.jsxs(ge,{className:"",children:[e.jsx(je,{children:e.jsxs(ne,{className:"",children:[e.jsx(C,{children:"Name"}),e.jsx(C,{children:"Type"}),e.jsx(C,{children:"Date"}),e.jsx(C,{children:"Filters"}),e.jsx(C,{children:"Status"}),e.jsx(C,{children:"Action"})]})}),e.jsx(ve,{children:(Q=c==null?void 0:c.data)==null?void 0:Q.filter(t=>$(t)).map(t=>(t={...t,...JSON.parse(t==null?void 0:t.report_params)},e.jsxs(ne,{className:"m-0",children:[e.jsx(z,{children:t==null?void 0:t.name}),e.jsx(z,{children:me(t==null?void 0:t.report_type)}),e.jsxs(z,{children:[J(t==null?void 0:t.from_date)," ","-"," ",J(t==null?void 0:t.to_date)]}),e.jsxs(z,{children:[(t==null?void 0:t.district)&&e.jsxs(w,{color:"gray",className:"capitalize",children:["District: ",t==null?void 0:t.district]}),(t==null?void 0:t.gender)&&e.jsxs(w,{color:"gray",className:"capitalize",children:["Gender: ",t==null?void 0:t.gender]}),(t==null?void 0:t.product)&&e.jsxs(w,{color:"gray",className:"capitalize",children:["Crop: ",t==null?void 0:t.product]}),(t==null?void 0:t.farm_size)&&e.jsxs(w,{color:"gray",className:"capitalize",children:["Farm size: ",t==null?void 0:t.farm_size]}),(t==null?void 0:t.agent_id)&&e.jsx(w,{color:"gray",className:"capitalize",children:"Agent"}),(t==null?void 0:t.fpo_id)&&e.jsx(w,{color:"gray",className:"capitalize",children:"FPO"})]}),e.jsx(z,{children:(t==null?void 0:t.report_status)==="pending"?e.jsx(w,{className:"capitalize",size:"md",color:"orange",children:"pending"}):(t==null?void 0:t.report_status)==="completed"?e.jsx(w,{className:"capitalize",size:"md",color:"green",children:"completed"}):e.jsx(w,{className:"capitalize",size:"md",color:"red",children:"failed"})}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[(t==null?void 0:t.report_status)==="completed"?e.jsx("a",{target:"_blank",title:"Download",href:`/reports/${t==null?void 0:t.report_url}`,className:"text-secondary transition-all duration-700",children:e.jsx(ce,{className:"h-5 w-5 hover:scale-125"})}):e.jsx(ce,{className:"h-5 w-5 text-tremor-brand-muted cursor-not-allowed"}),e.jsx("span",{onClick:()=>{ze(()=>de(t==null?void 0:t.id))},title:"Delete",children:e.jsx(be,{className:"h-5 w-5 text-danger cursor-pointer"})})]})})]},t==null?void 0:t.id)))})]}),e.jsx(Ce,{currentPage:u,moveToPage:i,fetchPage:y,setMoveToPage:l,nextPageUrl:R,prevPageUrl:v,lastPage:x,totalPages:c==null?void 0:c.last_page}),e.jsx(Ve,{showModal:d,setShowModal:r})]})})}const Ie=n=>`${Intl.NumberFormat("us").format(n).toString()}%`,Ue=n=>Intl.NumberFormat("us").format(n).toString();function We(){const n=U(),m=A(i=>i.auth.token),d=A(i=>i.reports.farmersPerDistrict),r=A(i=>i.reports.stats),{updateAppContextState:c}=h.useContext(D),s={relative:d.map(i=>{var l;return{district_name:i.name,"Farmers Profiled":(i.farmers_count/((l=r==null?void 0:r.system_stats)==null?void 0:l.total_farmers)*100).toFixed(2)}}),absolute:d.map(i=>({district_name:i.name,"Farmers Profiled":i.farmers_count}))},u=(i=`${p}/summary`)=>{c("loading",!0),axios.get(i,{headers:{Authorization:`Bearer ${m}`}}).then(l=>{console.log("Stats Data",l==null?void 0:l.data);let x=l==null?void 0:l.data;l!=null&&l.data&&n(M({reportType:"stats",reportData:x}))}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})},_=(i=`${p}/districts`)=>{c("loading",!0),axios.get(i,{headers:{Authorization:`Bearer ${m}`}}).then(l=>{var o,v;console.log("District Data",(o=l==null?void 0:l.data)==null?void 0:o.data);let x=(v=l==null?void 0:l.data)==null?void 0:v.data;l!=null&&l.data&&n(M({reportType:"farmersPerDistrict",reportData:Object.keys(x).map(F=>({name:F,farmers_count:x[F]}))}))}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})};return h.useEffect(()=>{u(),_()},[m]),e.jsx(k,{className:"my-4",children:e.jsxs(T,{children:[e.jsxs("div",{className:"block sm:flex sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(q,{children:"District Performance"}),e.jsx(G,{children:"Farmers Profiled"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(X,{variant:"solid",children:[e.jsx(b,{children:"relative"}),e.jsx(b,{children:"absolute"})]})})]}),e.jsxs(H,{children:[e.jsx(P,{children:e.jsx(I,{className:"mt-8 h-80",data:s.relative,index:"district_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Ie,yAxisWidth:40})}),e.jsx(P,{children:e.jsx(I,{className:"mt-8 h-80",data:s.absolute,index:"district_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Ue,yAxisWidth:40,showXAxis:!0})})]})]})})}const Te=n=>`${re(n)}`;function qe(){var l;const n=A(x=>x.auth.token),{updateAppContextState:m}=h.useContext(D),[d,r]=h.useState([]),[c,s]=h.useState({}),u=Object.keys(d).map(x=>({date:x,"Farmers Registered":d[x]})),_=(x=`${p}/summary`)=>{m("loading",!0),axios.get(x,{headers:{Authorization:`Bearer ${n}`}}).then(o=>{console.log("Stats Data",o==null?void 0:o.data);let v=o==null?void 0:o.data;o!=null&&o.data&&s(v)}).catch(o=>{console.log(o)}).finally(()=>{m("loading",!1)})},i=(x=`${p}/farmer/date/summary`)=>{m("loading",!0),axios.get(x,{headers:{Authorization:`Bearer ${n}`}}).then(o=>{var F,R;console.log("Registration Data",(F=o==null?void 0:o.data)==null?void 0:F.data);let v=(R=o==null?void 0:o.data)==null?void 0:R.data;o!=null&&o.data&&r(v)}).catch(o=>{console.log(o)}).finally(()=>{m("loading",!1)})};return h.useEffect(()=>{_(),i()},[n]),e.jsxs(k,{className:"mx-auto",children:[e.jsx(G,{children:"Total Farmers"}),e.jsx(pe,{children:re((l=c==null?void 0:c.system_stats)==null?void 0:l.total_farmers)}),e.jsx(ye,{className:"mt-8 h-44",data:u,categories:["Farmers Registered"],index:"date",colors:["orange"],valueFormatter:Te,showYAxis:!1,showLegend:!1})]})}const ra=()=>e.jsx(k,{className:"my-4 w-full h-full",children:e.jsxs(T,{children:[e.jsxs(X,{className:"",children:[e.jsx(b,{icon:Pe,children:"Reports"}),e.jsx(b,{icon:Le,children:"Agent Performance"}),e.jsx(b,{icon:$e,children:"Farmers Per District"}),e.jsx(b,{icon:Se,children:"Farmer Registration By Date"})]}),e.jsxs(H,{children:[e.jsx(P,{children:e.jsx("div",{className:"w-full h-full",children:e.jsx(Me,{})})}),e.jsx(P,{children:e.jsx(Be,{})}),e.jsx(P,{children:e.jsx(We,{})}),e.jsx(P,{children:e.jsx(qe,{})})]})]})});export{ra as default};
