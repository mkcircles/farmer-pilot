import{u as R,r as d,A as z,j as e,B as y,R as Z,a as ie,b as ce,s as me,v as he,l as ee,c as ae}from"./app-9c2b694a.js";import{b as D,d as U,e as W,m as q,h as G,i as S,n as X,j as $,k as V,P as E,l as L,o as C,p as te,q as ue,r as xe,t as fe,v as ge,w as se,x as N,y as je,z as F,A as M,s as ve,E as pe}from"./Tracker-7b8e620e.js";import{F as O}from"./index-7ecb442f.js";import{B as ye}from"./index-8345b162.js";import{L as _e,F as Ne,H as le,U as Fe,a as we,D as ne,T as Ae,b as be,c as Se,C as $e}from"./index-2e79ae6c.js";import{F as w}from"./index-94eb3ee2.js";import{U as Pe}from"./UserGroupIcon-304112c1.js";import{P as Ce}from"./index-b4cbe93c.js";import{W as Re}from"./WithConfirmAlert-d1ce5510.js";import{n as oe}from"./numberFormatter-373bc269.js";import"./Transition-d5809df2.js";import"./default-config-939e3be8.js";import"./tw-merge-fbb83fc6.js";const ze=n=>`${Intl.NumberFormat("us").format(n).toString()}%`,De=n=>Intl.NumberFormat("us").format(n).toString();function ke(){const n=R(r=>r.auth.token),{updateAppContextState:o}=d.useContext(z),[h,m]=d.useState([]),[i,l]=d.useState({}),u={relative:h.map(r=>{var s;return{agent_name:r.name,"Farmers Profiled":(r.farmers_count/((s=i==null?void 0:i.system_stats)==null?void 0:s.total_farmers)*100).toFixed(2)}}),absolute:h.map(r=>({agent_name:r.name,"Farmers Profiled":r.farmers_count}))},A=(r=`${y}/summary`)=>{o("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{console.log("Stats Data",s==null?void 0:s.data);let c=s==null?void 0:s.data;s!=null&&s.data&&l(c)}).catch(s=>{console.log(s)}).finally(()=>{o("loading",!1)})},j=(r=`${y}/agents/graph`)=>{o("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{var v,p;console.log("Agent Graph Data",(v=s==null?void 0:s.data)==null?void 0:v.data);let c=(p=s==null?void 0:s.data)==null?void 0:p.data;s!=null&&s.data&&m(c)}).catch(s=>{console.log(s)}).finally(()=>{o("loading",!1)})};return d.useEffect(()=>{j(),A()},[]),e.jsx(D,{className:"my-4",children:e.jsxs(U,{children:[e.jsxs("div",{className:"block sm:flex sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{children:"Agent Performance"}),e.jsx(q,{children:"Farmers Profiled"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(G,{variant:"solid",children:[e.jsx(S,{children:"relative"}),e.jsx(S,{children:"absolute"})]})})]}),e.jsxs(X,{children:[e.jsx($,{children:e.jsx(V,{className:"mt-8 h-80",data:u.relative,index:"agent_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:ze,yAxisWidth:40})}),e.jsx($,{children:e.jsx(V,{className:"mt-8 h-80",data:u.absolute,index:"agent_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:De,yAxisWidth:40,showXAxis:!0})})]})]})})}function I(){return I=Object.assign||function(n){for(var o=1;o<arguments.length;o++){var h=arguments[o];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(n[m]=h[m])}return n},I.apply(this,arguments)}function Be(n,o){if(n==null)return{};var h=Ee(n,o),m,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(i=0;i<l.length;i++)m=l[i],!(o.indexOf(m)>=0)&&Object.prototype.propertyIsEnumerable.call(n,m)&&(h[m]=n[m])}return h}function Ee(n,o){if(n==null)return{};var h={},m=Object.keys(n),i,l;for(l=0;l<m.length;l++)i=m[l],!(o.indexOf(i)>=0)&&(h[i]=n[i]);return h}var H=d.forwardRef(function(n,o){var h=n.color,m=h===void 0?"currentColor":h,i=n.size,l=i===void 0?24:i,u=Be(n,["color","size"]);return Z.createElement("svg",I({ref:o,xmlns:"http://www.w3.org/2000/svg",width:l,height:l,viewBox:"0 0 24 24",fill:"none",stroke:m,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},u),Z.createElement("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"}))});H.propTypes={color:E.string,size:E.oneOfType([E.string,E.number])};H.displayName="Activity";const Le=H,Oe=({showModal:n,setShowModal:o})=>{const h=ie();ce();const{updateAppContextState:m}=d.useContext(z),i=R(a=>{var x;return(x=a.auth)==null?void 0:x.token}),[l,u]=d.useState({name:"",report_type:"farmer-report",from_date:"2023-07-01",to_date:"2023-07-01",district:"",agent_id:"",crops_grown:"",farm_size:"",gender:"",fpo_id:""}),[A,j]=d.useState([]),[r,s]=d.useState([]),c=[{name:"Farmers Report",value:"farmer-report"},{name:"Crops Report",value:"crop-report"},{name:"Custom Report",value:"custom-report"}],v=()=>{m("loading",!0),axios.post(`${y}/report/register`,{...l},{headers:{Authorization:`Bearer ${i}`}}).then(a=>{o(!1),h(me({id:he(),message:"Report has been created successfully and queued for processing!"}))}).catch(a=>{}).finally(()=>{m("loading",!1)})},p=()=>{m("loading",!0),axios.get(`${y}/agents/all`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{var P,_;console.log("Agent Data",(P=a==null?void 0:a.data)==null?void 0:P.data);let x=(_=a==null?void 0:a.data)==null?void 0:_.data;a!=null&&a.data&&j(x)}).catch(a=>{console.log(a)}).finally(()=>{m("loading",!1)})},b=()=>{m("loading",!0),axios.get(`${y}/fpos/summary`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{var P,_;console.log("FPO Data",(P=a==null?void 0:a.data)==null?void 0:P.data);let x=(_=a==null?void 0:a.data)==null?void 0:_.data;a!=null&&a.data&&s(x)}).catch(a=>{console.log(a)}).finally(()=>{m("loading",!1)})},k=a=>`${a==null?void 0:a.getFullYear()}-${(a==null?void 0:a.getMonth())+1<10?`0${(a==null?void 0:a.getMonth())+1}`:(a==null?void 0:a.getMonth())+1}-${(a==null?void 0:a.getDate())<10?`0${a==null?void 0:a.getDate()}`:a==null?void 0:a.getDate()}`;return d.useEffect(()=>{p(),b()},[]),e.jsxs("div",{className:`z-[1000] my-3 fixed bg-primary rounded-md shadow-md transition-all h-full top-20 bottom-0 right-0 w-full lg:w-1/2 duration-700  ${n?"translate-x-0  ":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex w-full space-x-8 p-4 ",children:[e.jsx("span",{className:"text-white",onClick:()=>o(!1),children:e.jsx(_e,{icon:"XSquare"})}),e.jsx(W,{className:"text-white",children:"Create New Report"})]}),e.jsx("div",{className:"h-full flex flex-col flex-grow bg-slate-50",children:e.jsxs("form",{className:"py-4 px-8 bg-slate-50",onSubmit:a=>{a.preventDefault(),v()},children:[e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"name",children:"Report Name"}),e.jsx(O,{id:"name",required:!0,type:"text",placeholder:"",value:l==null?void 0:l.name,onChange:a=>u({...l,name:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"report_type",children:"Report Type"}),e.jsx(L,{defaultValue:"farmer-report",value:l==null?void 0:l.report_type,onValueChange:a=>u({...l,report_type:a}),children:c==null?void 0:c.map((a,x)=>e.jsx(C,{value:a==null?void 0:a.value,icon:Ne,children:a==null?void 0:a.name},x))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4 w-full",children:[e.jsx(w,{htmlFor:"from_date",children:"From"}),e.jsx(te,{defaultValue:new Date(l==null?void 0:l.from_date),onValueChange:a=>{u({...l,from_date:k(a)})},className:""})]}),e.jsxs("div",{className:"py-4 w-full",children:[e.jsx(w,{htmlFor:"to_date",children:"To"}),e.jsx(te,{defaultValue:new Date(l==null?void 0:l.to_date),onValueChange:a=>{u({...l,to_date:k(a)})},className:""})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"fpo_id",children:"FPO"}),e.jsx(L,{defaultValue:"",value:l==null?void 0:l.fpo_id,onValueChange:a=>u({...l,fpo_id:a}),children:["All",...r].map((a,x)=>a==="All"?e.jsx(C,{value:"",icon:le,children:"All FPOs"},x):e.jsx(C,{value:a==null?void 0:a.id,icon:le,children:a==null?void 0:a.fpo_name},x))})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"agent_id",children:"Agent"}),e.jsx(L,{defaultValue:"",value:l==null?void 0:l.agent_id,onValueChange:a=>u({...l,agent_id:a}),children:["All",...A].map((a,x)=>a==="All"?e.jsx(C,{value:"",icon:Pe,children:"All agents"},x):e.jsx(C,{value:a==null?void 0:a.id,icon:Fe,children:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)},x))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"district",children:"District"}),e.jsx(O,{id:"district",type:"text",placeholder:"District",value:l==null?void 0:l.district,onChange:a=>u({...l,district:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"gender",children:"Gender"}),e.jsx(L,{value:l==null?void 0:l.gender,onValueChange:a=>u({...l,gender:a}),children:["All","Male","Female"].map((a,x)=>a==="All"?e.jsx(C,{value:"",children:a},x):e.jsx(C,{value:a,children:a},x))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"product",children:"Product"}),e.jsx(O,{id:"product",type:"text",placeholder:"E.g Maize",value:l==null?void 0:l.product,onChange:a=>u({...l,product:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(w,{htmlFor:"farm_size",children:"Farm Size (Acres)"}),e.jsx(O,{id:"farm_size",type:"number",placeholder:"",value:l==null?void 0:l.farm_size,onChange:a=>u({...l,farm_size:a.target.value})})]})]}),e.jsx("div",{className:"flex py-4",children:e.jsx(ye,{variant:"primary",className:"w-full",onClick:()=>{},children:"Save"})})]})})]})};function Ve(){var Y,J;ie(),ce();const n=R(t=>t.auth.token),{updateAppContextState:o}=d.useContext(z),[h,m]=d.useState(!1),[i,l]=d.useState([]),[u,A]=d.useState(1),[j,r]=d.useState(1),[s,c]=d.useState(1),[v,p]=d.useState(""),[b,k]=d.useState(""),[a,x]=d.useState([]),P=t=>{if(a.length===0||(a==null?void 0:a.find(f=>ee.isEqual(f,t==null?void 0:t.name))))return!0},_=({showLoading:t}={showLoading:!0})=>{let B=`${y}/reports`;o("loading",t),ae.get(B,{headers:{Authorization:`Bearer ${n}`}}).then(f=>{var K,Q;console.log("Reports Data",(K=f==null?void 0:f.data)==null?void 0:K.data);let g=(Q=f==null?void 0:f.data)==null?void 0:Q.data;f!=null&&f.data&&(A(g==null?void 0:g.current_page),p(g==null?void 0:g.prev_page_url),k(g==null?void 0:g.next_page_url),c(g==null?void 0:g.last_page),l(g))}).catch(f=>{console.log(f)}).finally(()=>{o("loading",!1)})};d.useEffect(()=>{_()},[n]),d.useEffect(()=>{j!=u&&r(u)},[u]),d.useEffect(()=>{j!=u&&ee.debounce(_,1e3)(`${y}/reports?page=${j||1}`)},[j]),d.useEffect(()=>{h||_({showLoading:!1})},[h]);const T=t=>new Date(t).toLocaleDateString("en-us",{day:"numeric",year:"numeric",month:"short"}),re=t=>(o("loading",!0),new Promise((B,f)=>{ae.delete(`${y}/report/${t}`,{headers:{Authorization:`Bearer ${n}`}}).then(()=>{_(),B({title:"success",message:"Report deleted successfully"})}).catch(g=>{console.log(g),f({message:"Something went wrong. Report could not be deleted",title:"error"})}).finally(()=>{o("loading",!1)})})),de=t=>{switch(t){case"crop-report":return"Crops Report";case"farmer-report":return"Farmers Report";case"custom-report":return"Custom Report";default:return t}};return e.jsx("div",{className:"w-full h-full",children:e.jsxs(D,{className:" px-0",children:[e.jsxs("div",{className:"flex border-b space-x-4 items-center w-full lg:justify-between justify-start pb-4",children:[e.jsx("div",{className:"flex items-center w-52 lg:w-80",children:e.jsx(ue,{onValueChange:x,placeholder:"Search Reports...",className:"max-w-md",children:(Y=i==null?void 0:i.data)==null?void 0:Y.map(t=>e.jsx(xe,{value:t==null?void 0:t.name,children:t==null?void 0:t.name},t==null?void 0:t.id))})}),e.jsx("div",{className:"flex",children:e.jsxs("button",{onClick:()=>m(!0),className:"group flex space-x-2 px-4 py-3 border border-secondary rounded text-secondary",children:[e.jsx(we,{className:"w-5 h-5 group-hover:scale-125 "}),e.jsx("span",{className:"group-hover:scale-95",children:"New Report"})]})})]}),e.jsxs(fe,{className:"",children:[e.jsx(ge,{children:e.jsxs(se,{className:"",children:[e.jsx(N,{children:"Name"}),e.jsx(N,{children:"Type"}),e.jsx(N,{children:"Date"}),e.jsx(N,{children:"District"}),e.jsx(N,{children:"Agent"}),e.jsx(N,{children:"Product"}),e.jsx(N,{children:"Farm Size (Acres)"}),e.jsx(N,{children:"Gender"}),e.jsx(N,{children:"Status"}),e.jsx(N,{children:"Action"})]})}),e.jsx(je,{children:(J=i==null?void 0:i.data)==null?void 0:J.filter(t=>P(t)).map(t=>(t={...t,...JSON.parse(t==null?void 0:t.report_params)},e.jsxs(se,{className:"m-0",children:[e.jsx(F,{children:t==null?void 0:t.name}),e.jsx(F,{children:de(t==null?void 0:t.report_type)}),e.jsxs(F,{children:[T(t==null?void 0:t.from_date)," ","-"," ",T(t==null?void 0:t.to_date)]}),e.jsx(F,{children:(t==null?void 0:t.district)||"-"}),e.jsx(F,{children:(t==null?void 0:t.agent_id)||"-"}),e.jsx(F,{children:(t==null?void 0:t.product)||"-"}),e.jsx(F,{children:(t==null?void 0:t.farm_size)||"-"}),e.jsx(F,{children:(t==null?void 0:t.gender)||"-"}),e.jsx(F,{children:(t==null?void 0:t.report_status)==="pending"?e.jsx(M,{className:"capitalize",size:"md",color:"orange",children:"pending"}):(t==null?void 0:t.report_status)==="completed"?e.jsx(M,{className:"capitalize",size:"md",color:"green",children:"completed"}):e.jsx(M,{className:"capitalize",size:"md",color:"red",children:"failed"})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[(t==null?void 0:t.report_status)==="completed"?e.jsx("a",{target:"_blank",title:"Download",href:`/reports/${t==null?void 0:t.report_url}`,className:"text-secondary transition-all duration-700",children:e.jsx(ne,{className:"h-5 w-5 hover:scale-125"})}):e.jsx(ne,{className:"h-5 w-5 text-tremor-brand-muted cursor-not-allowed"}),e.jsx("span",{onClick:()=>{Re(()=>re(t==null?void 0:t.id))},title:"Delete",children:e.jsx(Ae,{className:"h-5 w-5 text-danger cursor-pointer"})})]})})]},t==null?void 0:t.id)))})]}),e.jsx(Ce,{currentPage:u,moveToPage:j,fetchPage:_,setMoveToPage:r,nextPageUrl:b,prevPageUrl:v,lastPage:s,totalPages:i==null?void 0:i.last_page}),e.jsx(Oe,{showModal:h,setShowModal:m})]})})}const Me=n=>`${Intl.NumberFormat("us").format(n).toString()}%`,Ie=n=>Intl.NumberFormat("us").format(n).toString();function Ue(){const n=R(r=>r.auth.token),{updateAppContextState:o}=d.useContext(z),[h,m]=d.useState([]),[i,l]=d.useState({}),u={relative:h.map(r=>{var s;return{district_name:r.name,"Farmers Profiled":(r.farmers_count/((s=i==null?void 0:i.system_stats)==null?void 0:s.total_farmers)*100).toFixed(2)}}),absolute:h.map(r=>({district_name:r.name,"Farmers Profiled":r.farmers_count}))},A=(r=`${y}/summary`)=>{o("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{console.log("Stats Data",s==null?void 0:s.data);let c=s==null?void 0:s.data;s!=null&&s.data&&l(c)}).catch(s=>{console.log(s)}).finally(()=>{o("loading",!1)})},j=(r=`${y}/districts`)=>{o("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{var v,p;console.log("District Data",(v=s==null?void 0:s.data)==null?void 0:v.data);let c=(p=s==null?void 0:s.data)==null?void 0:p.data;s!=null&&s.data&&m(Object.keys(c).map(b=>({name:b,farmers_count:c[b]})))}).catch(s=>{console.log(s)}).finally(()=>{o("loading",!1)})};return d.useEffect(()=>{A(),j()},[n]),e.jsx(D,{className:"my-4",children:e.jsxs(U,{children:[e.jsxs("div",{className:"block sm:flex sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{children:"District Performance"}),e.jsx(q,{children:"Farmers Profiled"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(G,{variant:"solid",children:[e.jsx(S,{children:"relative"}),e.jsx(S,{children:"absolute"})]})})]}),e.jsxs(X,{children:[e.jsx($,{children:e.jsx(V,{className:"mt-8 h-80",data:u.relative,index:"district_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Me,yAxisWidth:40})}),e.jsx($,{children:e.jsx(V,{className:"mt-8 h-80",data:u.absolute,index:"district_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Ie,yAxisWidth:40,showXAxis:!0})})]})]})})}const We=n=>`${oe(n)}`;function qe(){var r;const n=R(s=>s.auth.token),{updateAppContextState:o}=d.useContext(z),[h,m]=d.useState([]),[i,l]=d.useState({}),u=Object.keys(h).map(s=>({date:s,farmers_count:h[s]})),A=(s=`${y}/summary`)=>{o("loading",!0),axios.get(s,{headers:{Authorization:`Bearer ${n}`}}).then(c=>{console.log("Stats Data",c==null?void 0:c.data);let v=c==null?void 0:c.data;c!=null&&c.data&&l(v)}).catch(c=>{console.log(c)}).finally(()=>{o("loading",!1)})},j=(s=`${y}/farmer/date/summary`)=>{o("loading",!0),axios.get(s,{headers:{Authorization:`Bearer ${n}`}}).then(c=>{var p,b;console.log("Registration Data",(p=c==null?void 0:c.data)==null?void 0:p.data);let v=(b=c==null?void 0:c.data)==null?void 0:b.data;c!=null&&c.data&&m(v)}).catch(c=>{console.log(c)}).finally(()=>{o("loading",!1)})};return d.useEffect(()=>{A(),j()},[n]),e.jsxs(D,{className:"mx-auto",children:[e.jsx(q,{children:"Total Farmers"}),e.jsx(ve,{children:oe((r=i==null?void 0:i.system_stats)==null?void 0:r.total_farmers)}),e.jsx(pe,{className:"mt-8 h-44",data:u,categories:["farmers_count"],index:"date",colors:["orange"],valueFormatter:We,showYAxis:!1,showLegend:!1})]})}const la=()=>e.jsx(D,{className:"my-4 w-full h-full",children:e.jsxs(U,{children:[e.jsxs(G,{className:"",children:[e.jsx(S,{icon:be,children:"Reports"}),e.jsx(S,{icon:Le,children:"Agent Performance"}),e.jsx(S,{icon:Se,children:"Farmers Per District"}),e.jsx(S,{icon:$e,children:"Farmer Registration By Date"})]}),e.jsxs(X,{children:[e.jsx($,{children:e.jsx("div",{className:"w-full h-full",children:e.jsx(Ve,{})})}),e.jsx($,{children:e.jsx(ke,{})}),e.jsx($,{children:e.jsx(Ue,{})}),e.jsx($,{children:e.jsx(qe,{})})]})]})});export{la as default};
