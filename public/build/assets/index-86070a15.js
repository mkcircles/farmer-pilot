import{u as E,r as d,A as B,j as e,B as y,R as Q,a as ne,b as ie,s as de,v as me,l as Z,c as ee}from"./app-65fbab72.js";import{b as V,d as U,e as W,m as ce,h as q,i as P,n as G,j as $,k as O,P as k,l as D,o as S,p as ae,q as he,r as ue,t as xe,v as fe,w as se,x as p,y as ge,z as _,A as M}from"./Tracker-33d5ea18.js";import{F as L}from"./index-c61fa346.js";import{B as je}from"./index-886d5e62.js";import{L as ve,F as pe,H as te,U as _e,a as Ne,D as le,T as ye,b as we,c as Fe}from"./index-0438ef2a.js";import{F as N}from"./index-32124735.js";import{U as Ae}from"./UserGroupIcon-36891082.js";import{P as be}from"./index-0cba895a.js";import{W as Se}from"./WithConfirmAlert-bf084f0b.js";import"./Transition-da004935.js";import"./default-config-939e3be8.js";import"./tw-merge-fbb83fc6.js";import"./numberFormatter-373bc269.js";const Pe=n=>`${Intl.NumberFormat("us").format(n).toString()}%`,$e=n=>Intl.NumberFormat("us").format(n).toString();function Ce(){const n=E(r=>r.auth.token),{updateAppContextState:c}=d.useContext(B),[m,o]=d.useState([]),[i,t]=d.useState({}),h={relative:m.map(r=>{var l;return{agent_name:r.name,"Farmers Profiled":(r.farmers_count/((l=i==null?void 0:i.system_stats)==null?void 0:l.total_farmers)*100).toFixed(2)}}),absolute:m.map(r=>({agent_name:r.name,"Farmers Profiled":r.farmers_count}))},A=(r=`${y}/summary`)=>{c("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{console.log("Stats Data",l==null?void 0:l.data);let g=l==null?void 0:l.data;l!=null&&l.data&&t(g)}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})},j=(r=`${y}/agents/graph`)=>{c("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{var w,F;console.log("Agent Graph Data",(w=l==null?void 0:l.data)==null?void 0:w.data);let g=(F=l==null?void 0:l.data)==null?void 0:F.data;l!=null&&l.data&&o(g)}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})};return d.useEffect(()=>{j(),A()},[]),e.jsx(V,{className:"my-4",children:e.jsxs(U,{children:[e.jsxs("div",{className:"block sm:flex sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{children:"Agent Performance"}),e.jsx(ce,{children:"Farmers Profiled"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(q,{variant:"solid",children:[e.jsx(P,{children:"relative"}),e.jsx(P,{children:"absolute"})]})})]}),e.jsxs(G,{children:[e.jsx($,{children:e.jsx(O,{className:"mt-8 h-80",data:h.relative,index:"agent_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Pe,yAxisWidth:40})}),e.jsx($,{children:e.jsx(O,{className:"mt-8 h-80",data:h.absolute,index:"agent_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:$e,yAxisWidth:40,showXAxis:!0})})]})]})})}function I(){return I=Object.assign||function(n){for(var c=1;c<arguments.length;c++){var m=arguments[c];for(var o in m)Object.prototype.hasOwnProperty.call(m,o)&&(n[o]=m[o])}return n},I.apply(this,arguments)}function Re(n,c){if(n==null)return{};var m=ze(n,c),o,i;if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);for(i=0;i<t.length;i++)o=t[i],!(c.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(n,o)&&(m[o]=n[o])}return m}function ze(n,c){if(n==null)return{};var m={},o=Object.keys(n),i,t;for(t=0;t<o.length;t++)i=o[t],!(c.indexOf(i)>=0)&&(m[i]=n[i]);return m}var X=d.forwardRef(function(n,c){var m=n.color,o=m===void 0?"currentColor":m,i=n.size,t=i===void 0?24:i,h=Re(n,["color","size"]);return Q.createElement("svg",I({ref:c,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},h),Q.createElement("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"}))});X.propTypes={color:k.string,size:k.oneOfType([k.string,k.number])};X.displayName="Activity";const ke=X,De=({showModal:n,setShowModal:c})=>{const m=ne();ie();const{updateAppContextState:o}=d.useContext(B),i=E(a=>{var u;return(u=a.auth)==null?void 0:u.token}),[t,h]=d.useState({name:"",report_type:"farmer-report",from_date:"2023-07-01",to_date:"2023-07-01",district:"",agent_id:"",crops_grown:"",farm_size:"",gender:"",fpo_id:""}),[A,j]=d.useState([]),[r,l]=d.useState([]),g=[{name:"Farmers Report",value:"farmer-report"},{name:"Crops Report",value:"crop-report"},{name:"Custom Report",value:"custom-report"}],w=()=>{o("loading",!0),axios.post(`${y}/report/register`,{...t},{headers:{Authorization:`Bearer ${i}`}}).then(a=>{c(!1),m(de({id:me(),message:"Report has been created successfully and queued for processing!"}))}).catch(a=>{}).finally(()=>{o("loading",!1)})},F=()=>{o("loading",!0),axios.get(`${y}/agents/all`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{var b,v;console.log("Agent Data",(b=a==null?void 0:a.data)==null?void 0:b.data);let u=(v=a==null?void 0:a.data)==null?void 0:v.data;a!=null&&a.data&&j(u)}).catch(a=>{console.log(a)}).finally(()=>{o("loading",!1)})},C=()=>{o("loading",!0),axios.get(`${y}/fpos/summary`,{headers:{Authorization:`Bearer ${i}`}}).then(a=>{var b,v;console.log("FPO Data",(b=a==null?void 0:a.data)==null?void 0:b.data);let u=(v=a==null?void 0:a.data)==null?void 0:v.data;a!=null&&a.data&&l(u)}).catch(a=>{console.log(a)}).finally(()=>{o("loading",!1)})},R=a=>`${a==null?void 0:a.getFullYear()}-${(a==null?void 0:a.getMonth())+1<10?`0${(a==null?void 0:a.getMonth())+1}`:(a==null?void 0:a.getMonth())+1}-${(a==null?void 0:a.getDate())<10?`0${a==null?void 0:a.getDate()}`:a==null?void 0:a.getDate()}`;return d.useEffect(()=>{F(),C()},[]),e.jsxs("div",{className:`z-[1000] my-3 fixed bg-primary rounded-md shadow-md transition-all h-full top-20 bottom-0 right-0 w-full lg:w-1/2 duration-700  ${n?"translate-x-0  ":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex w-full space-x-8 p-4 ",children:[e.jsx("span",{className:"text-white",onClick:()=>c(!1),children:e.jsx(ve,{icon:"XSquare"})}),e.jsx(W,{className:"text-white",children:"Create New Report"})]}),e.jsx("div",{className:"h-full flex flex-col flex-grow bg-slate-50",children:e.jsxs("form",{className:"py-4 px-8 bg-slate-50",onSubmit:a=>{a.preventDefault(),w()},children:[e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"name",children:"Report Name"}),e.jsx(L,{id:"name",required:!0,type:"text",placeholder:"",value:t==null?void 0:t.name,onChange:a=>h({...t,name:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"report_type",children:"Report Type"}),e.jsx(D,{defaultValue:"farmer-report",value:t==null?void 0:t.report_type,onValueChange:a=>h({...t,report_type:a}),children:g==null?void 0:g.map((a,u)=>e.jsx(S,{value:a==null?void 0:a.value,icon:pe,children:a==null?void 0:a.name},u))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4 w-full",children:[e.jsx(N,{htmlFor:"from_date",children:"From"}),e.jsx(ae,{defaultValue:new Date(t==null?void 0:t.from_date),onValueChange:a=>{h({...t,from_date:R(a)})},className:""})]}),e.jsxs("div",{className:"py-4 w-full",children:[e.jsx(N,{htmlFor:"to_date",children:"To"}),e.jsx(ae,{defaultValue:new Date(t==null?void 0:t.to_date),onValueChange:a=>{h({...t,to_date:R(a)})},className:""})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"fpo_id",children:"FPO"}),e.jsx(D,{defaultValue:"",value:t==null?void 0:t.fpo_id,onValueChange:a=>h({...t,fpo_id:a}),children:["All",...r].map((a,u)=>a==="All"?e.jsx(S,{value:"",icon:te,children:"All FPOs"},u):e.jsx(S,{value:a==null?void 0:a.id,icon:te,children:a==null?void 0:a.fpo_name},u))})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"agent_id",children:"Agent"}),e.jsx(D,{defaultValue:"",value:t==null?void 0:t.agent_id,onValueChange:a=>h({...t,agent_id:a}),children:["All",...A].map((a,u)=>a==="All"?e.jsx(S,{value:"",icon:Ae,children:"All agents"},u):e.jsx(S,{value:a==null?void 0:a.id,icon:_e,children:(a==null?void 0:a.first_name)+" "+(a==null?void 0:a.last_name)},u))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"district",children:"District"}),e.jsx(L,{id:"district",type:"text",placeholder:"District",value:t==null?void 0:t.district,onChange:a=>h({...t,district:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"gender",children:"Gender"}),e.jsx(D,{value:t==null?void 0:t.gender,onValueChange:a=>h({...t,gender:a}),children:["All","Male","Female"].map((a,u)=>a==="All"?e.jsx(S,{value:"",children:a},u):e.jsx(S,{value:a,children:a},u))})]})]}),e.jsxs("div",{className:" grid grid-cols-1 md:grid-cols-2 gap-x-4 items-center",children:[e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"product",children:"Product"}),e.jsx(L,{id:"product",type:"text",placeholder:"E.g Maize",value:t==null?void 0:t.product,onChange:a=>h({...t,product:a.target.value})})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(N,{htmlFor:"farm_size",children:"Farm Size (Acres)"}),e.jsx(L,{id:"farm_size",type:"number",placeholder:"",value:t==null?void 0:t.farm_size,onChange:a=>h({...t,farm_size:a.target.value})})]})]}),e.jsx("div",{className:"flex py-4",children:e.jsx(je,{variant:"primary",className:"w-full",onClick:()=>{},children:"Save"})})]})})]})};function Le(){var J,T;ne(),ie();const n=E(s=>s.auth.token),{updateAppContextState:c}=d.useContext(B),[m,o]=d.useState(!1),[i,t]=d.useState([]),[h,A]=d.useState(1),[j,r]=d.useState(1),[l,g]=d.useState(1),[w,F]=d.useState(""),[C,R]=d.useState(""),[a,u]=d.useState([]),b=s=>{if(a.length===0||(a==null?void 0:a.find(x=>Z.isEqual(x,s==null?void 0:s.name))))return!0},v=({showLoading:s}={showLoading:!0})=>{let z=`${y}/reports`;c("loading",s),ee.get(z,{headers:{Authorization:`Bearer ${n}`}}).then(x=>{var Y,K;console.log("Reports Data",(Y=x==null?void 0:x.data)==null?void 0:Y.data);let f=(K=x==null?void 0:x.data)==null?void 0:K.data;x!=null&&x.data&&(A(f==null?void 0:f.current_page),F(f==null?void 0:f.prev_page_url),R(f==null?void 0:f.next_page_url),g(f==null?void 0:f.last_page),t(f))}).catch(x=>{console.log(x)}).finally(()=>{c("loading",!1)})};d.useEffect(()=>{v()},[n]),d.useEffect(()=>{j!=h&&r(h)},[h]),d.useEffect(()=>{j!=h&&Z.debounce(v,1e3)(`${y}/reports?page=${j||1}`)},[j]),d.useEffect(()=>{m||v({showLoading:!1})},[m]);const H=s=>new Date(s).toLocaleDateString("en-us",{day:"numeric",year:"numeric",month:"short"}),oe=s=>(c("loading",!0),new Promise((z,x)=>{ee.delete(`${y}/report/${s}`,{headers:{Authorization:`Bearer ${n}`}}).then(()=>{v(),z({title:"success",message:"Report deleted successfully"})}).catch(f=>{console.log(f),x({message:"Something went wrong. Report could not be deleted",title:"error"})}).finally(()=>{c("loading",!1)})})),re=s=>{switch(s){case"crop-report":return"Crops Report";case"farmer-report":return"Farmers Report";case"custom-report":return"Custom Report";default:return s}};return e.jsx("div",{className:"w-full h-full",children:e.jsxs(V,{className:" px-0",children:[e.jsxs("div",{className:"flex border-b space-x-4 items-center w-full lg:justify-between justify-start pb-4",children:[e.jsx("div",{className:"flex items-center w-52 lg:w-80",children:e.jsx(he,{onValueChange:u,placeholder:"Search Reports...",className:"max-w-md",children:(J=i==null?void 0:i.data)==null?void 0:J.map(s=>e.jsx(ue,{value:s==null?void 0:s.name,children:s==null?void 0:s.name},s==null?void 0:s.id))})}),e.jsx("div",{className:"flex",children:e.jsxs("button",{onClick:()=>o(!0),className:"group flex space-x-2 px-4 py-3 border border-secondary rounded text-secondary",children:[e.jsx(Ne,{className:"w-5 h-5 group-hover:scale-125 "}),e.jsx("span",{className:"group-hover:scale-95",children:"New Report"})]})})]}),e.jsxs(xe,{className:"",children:[e.jsx(fe,{children:e.jsxs(se,{className:"",children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Type"}),e.jsx(p,{children:"Date"}),e.jsx(p,{children:"District"}),e.jsx(p,{children:"Agent"}),e.jsx(p,{children:"Product"}),e.jsx(p,{children:"Farm Size (Acres)"}),e.jsx(p,{children:"Gender"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(ge,{children:(T=i==null?void 0:i.data)==null?void 0:T.filter(s=>b(s)).map(s=>(s={...s,...JSON.parse(s==null?void 0:s.report_params)},e.jsxs(se,{className:"m-0",children:[e.jsx(_,{children:s==null?void 0:s.name}),e.jsx(_,{children:re(s==null?void 0:s.report_type)}),e.jsxs(_,{children:[H(s==null?void 0:s.from_date)," ","-"," ",H(s==null?void 0:s.to_date)]}),e.jsx(_,{children:(s==null?void 0:s.district)||"-"}),e.jsx(_,{children:(s==null?void 0:s.agent_id)||"-"}),e.jsx(_,{children:(s==null?void 0:s.product)||"-"}),e.jsx(_,{children:(s==null?void 0:s.farm_size)||"-"}),e.jsx(_,{children:(s==null?void 0:s.gender)||"-"}),e.jsx(_,{children:(s==null?void 0:s.report_status)==="pending"?e.jsx(M,{className:"capitalize",size:"md",color:"orange",children:"pending"}):(s==null?void 0:s.report_status)==="completed"?e.jsx(M,{className:"capitalize",size:"md",color:"green",children:"completed"}):e.jsx(M,{className:"capitalize",size:"md",color:"red",children:"failed"})}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[(s==null?void 0:s.report_status)==="completed"?e.jsx("a",{target:"_blank",title:"Download",href:`/reports/${s==null?void 0:s.report_url}`,className:"text-secondary transition-all duration-700",children:e.jsx(le,{className:"h-5 w-5 hover:scale-125"})}):e.jsx(le,{className:"h-5 w-5 text-tremor-brand-muted cursor-not-allowed"}),e.jsx("span",{onClick:()=>{Se(()=>oe(s==null?void 0:s.id))},title:"Delete",children:e.jsx(ye,{className:"h-5 w-5 text-danger cursor-pointer"})})]})})]},s==null?void 0:s.id)))})]}),e.jsx(be,{currentPage:h,moveToPage:j,fetchPage:v,setMoveToPage:r,nextPageUrl:C,prevPageUrl:w,lastPage:l,totalPages:i==null?void 0:i.last_page}),e.jsx(De,{showModal:m,setShowModal:o})]})})}const Oe=n=>`${Intl.NumberFormat("us").format(n).toString()}%`,Ee=n=>Intl.NumberFormat("us").format(n).toString();function Be(){const n=E(r=>r.auth.token),{updateAppContextState:c}=d.useContext(B),[m,o]=d.useState([]),[i,t]=d.useState({}),h={relative:m.map(r=>{var l;return{district_name:r.name,"Farmers Profiled":(r.farmers_count/((l=i==null?void 0:i.system_stats)==null?void 0:l.total_farmers)*100).toFixed(2)}}),absolute:m.map(r=>({district_name:r.name,"Farmers Profiled":r.farmers_count}))},A=(r=`${y}/summary`)=>{c("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{console.log("Stats Data",l==null?void 0:l.data);let g=l==null?void 0:l.data;l!=null&&l.data&&t(g)}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})},j=(r=`${y}/districts`)=>{c("loading",!0),axios.get(r,{headers:{Authorization:`Bearer ${n}`}}).then(l=>{var w,F;console.log("District Data",(w=l==null?void 0:l.data)==null?void 0:w.data);let g=(F=l==null?void 0:l.data)==null?void 0:F.data;l!=null&&l.data&&o(Object.keys(g).map(C=>({name:C,farmers_count:g[C]})))}).catch(l=>{console.log(l)}).finally(()=>{c("loading",!1)})};return d.useEffect(()=>{A(),j()},[n]),e.jsx(V,{className:"my-4",children:e.jsxs(U,{children:[e.jsxs("div",{className:"block sm:flex sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{children:"District Performance"}),e.jsx(ce,{children:"Farmers Profiled"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(q,{variant:"solid",children:[e.jsx(P,{children:"relative"}),e.jsx(P,{children:"absolute"})]})})]}),e.jsxs(G,{children:[e.jsx($,{children:e.jsx(O,{className:"mt-8 h-80",data:h.relative,index:"district_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Oe,yAxisWidth:40})}),e.jsx($,{children:e.jsx(O,{className:"mt-8 h-80",data:h.absolute,index:"district_name",categories:["Farmers Profiled"],colors:["orange"],showLegend:!0,valueFormatter:Ee,yAxisWidth:40,showXAxis:!0})})]})]})})}const Qe=()=>e.jsx(V,{className:"my-4 w-full h-full",children:e.jsxs(U,{children:[e.jsxs(q,{className:"",children:[e.jsx(P,{icon:we,children:"Reports"}),e.jsx(P,{icon:ke,children:"Agent Performance"}),e.jsx(P,{icon:Fe,children:"Farmers Per District"})]}),e.jsxs(G,{children:[e.jsx($,{children:e.jsx("div",{className:"w-full h-full",children:e.jsx(Le,{})})}),e.jsx($,{children:e.jsx(Ce,{})}),e.jsx($,{children:e.jsx(Be,{})})]})]})});export{Qe as default};
